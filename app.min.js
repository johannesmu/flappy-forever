function resizeCanvas(){canvas=document.getElementById("gamecanvas"),container=document.getElementById("gamecontainer"),ww=container.offsetWidth,wh=container.offsetHeight,canvas.width=container.offsetWidth,canvas.height=wh-50,width=canvas.width,height=canvas.height,stage.update(),360>=width&&(scale=.6)}function initGame(){timer.on("tick",onTick,this),timer.setFPS(30),stage.addEventListener("stagemousedown",onStageClick),stage.on("stagemouseup",onStageMouseUp),setupPlayer(),intializeObstacles()}function resetGame(){window.location.reload()}function intializeObstacles(){for(i=0;i<obslist.length;i++)obs=new createjs.Bitmap(obsfolder+obslist[i]),obs.scaleX=2*scale,obs.scaleY=2*scale,get=obs.getTransformedBounds()}function onStageClick(){isalive&&(mouseisdown=!0)}function onStageMouseUp(){mouseisdown=!1}function onKeyDown(e){32==e.keyCode&&(mouseisdown=!0)}function onKeyUp(){mouseisdown=!1}function setupPlayer(){var e={images:["assets/sprites/bird.png"],frames:{width:200,height:120},animations:{fly:[0,3],dead:[5]}},t=new createjs.SpriteSheet(e),s=new createjs.Sprite(t,"fly");player=new createjs.Sprite(t,s),player.x=.3*width,player.y=height/2,player.scaleX=scale,player.scaleY=scale,player.regX=100,player.regY=80,player.gotoAndPlay("fly"),player.name="player",stage.addChild(player),stage.update()}function onTick(){0==timer.getPaused()&&((player.y<60||player.y>=height-50)&&killPlayer(),0==mouseisdown?createjs.Tween.get(player,{override:!0}).to({y:height},3e3):createjs.Tween.get(player,{override:!0}).to({y:0},2e3),manageObstacles(),showScore(),moveBackGround("gamebg",1)),stage.update()}function killPlayer(){if(1==isalive){player.gotoAndStop("dead"),isalive=!1,playerheight=player.getTransformedBounds().height,stopheight=playerheight+150;var e=window.setTimeout(function(){stopGame(),window.clearTimeOut(e)},5e3)}}function stopGame(){console.log("stop game"),timer.setPaused(!0),showMenu(!0)}function randomNumber(e,t){return rn=Math.random()*e,1==t?Math.round(rn):rn}function createObstacle(){return num=randomNumber(obslist.length-1,!0),size=1.8*scale,obs=new createjs.Bitmap(obsfolder+obslist[num]),obs.scaleX=size,obs.scaleY=size,ypos=height-obs.getTransformedBounds().height,space=randomNumber(ypos,!1),obs.y=space,obs.name="item",obs}function manageObstacles(){if(timer.getTicks()%interval==0)obstacle=createObstacle(),obstacle.x=width+1,obstacles.push(obstacle),stage.addChildAt(obstacle,0);else if(obstacles.length>0)for(i=0;i<obstacles.length;i++)obs=obstacles[i],pos=obs.x,obswidth=obs.getTransformedBounds().width,pos>width-2*width&&1==isalive?(obstacles[i].x=pos-obspeed,obstacles[i].x<=player.x&&"item"==obs.name&&1==isalive&&(addScore(),obs.name="remove")):-1*obswidth>pos&&stage.removeChild(obstacles.shift()),0!=checkCollision(player,obs)&&killPlayer()}function moveBackGround(e){pos=document.getElementById(e).style.backgroundPosition,console.log(pos)}function showMenu(e){1==e?(document.getElementById("restartbtn").addEventListener("mousedown",function(){resetGame()}),document.getElementById("restart").style.visibility="visible"):document.getElementById("restart").style.visibility="hidden"}function checkCollision(e,t){var s=ndgmr.checkPixelCollision(e,t,0,!0);return console.log(s),s}function showScore(){document.getElementById("score").innerHTML=score,document.getElementById("highscore").innerHTML=highscore}function addScore(){score++,score>=highscore&&(highscore=score),showScore()}function saveScore(){try{window.localStorage.setItem("highest",highscore)}catch(e){}}function readScore(){try{localStorage.length>0&&(storedscore=window.localStorage.getItem("highest"),highscore=storedscore)}catch(e){}}window.addEventListener("load",function(){resizeCanvas(),initGame(),readScore()}),window.addEventListener("unload",function(){saveScore()}),window.addEventListener("reload",function(){saveScore()}),window.addEventListener("resize",resizeCanvas,!1),window.addEventListener("keydown",onKeyDown),window.addEventListener("keyup",onKeyUp);var stage=new createjs.Stage("gamecanvas");createjs.Touch.enable(stage);var mouseisdown=!1,timer=createjs.Ticker,width,height,player,scale=.8,isalive=!0,playerheight,score=0,highscore=0,tween,interval=250,obspeed=2,obstacles=new Array;obsfolder="assets/images/",obslist=["obs_tv.png","obs_radio.png","obs_camera.png","obs_light.png","obs_mic.png"];